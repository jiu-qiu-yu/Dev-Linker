# ğŸ“… Dev-Linker å¼€å‘ä¼˜åŒ–æµç¨‹è®¡åˆ’æ–‡æ¡£



**ç›®æ ‡ï¼š**

1. **æ¨¡æ‹ŸçœŸå® 4G æ¨¡å—ä½“éªŒ**ï¼šå…ˆé€‰åè®®å¤§ç±»ï¼ˆå¦‚ WebSocketï¼‰ï¼Œå†å¡«å®Œæ•´åœ°å€ï¼ˆå¦‚ `ws://localhost:18080`ï¼‰ï¼Œåç«¯è‡ªåŠ¨è§£æã€‚
2. **IDE çº§ç•Œé¢å¸ƒå±€**ï¼šå…¨å±æ— æ»šåŠ¨è®¾è®¡ï¼Œå…³é”®é…ç½®ä¸€ç›®äº†ç„¶ï¼Œè¿æ¥æ§åˆ¶ç½®é¡¶ã€‚

------



## ğŸš€ é˜¶æ®µä¸€ï¼šæ ¸å¿ƒæ•°æ®ç»“æ„é‡æ„ (Logic Layer)



**ä»»åŠ¡ï¼š** ä¿®æ”¹ç±»å‹å®šä¹‰å’ŒçŠ¶æ€ç®¡ç†ï¼Œæ”¯æŒâ€œå®Œæ•´åœ°å€è¾“å…¥â€å’Œâ€œåè®®å¤§ç±»é€‰æ‹©â€ã€‚



### 1. ä¿®æ”¹ç±»å‹å®šä¹‰



**æ–‡ä»¶ï¼š** `src/shared/types.ts`

TypeScript

```
// 1. å®šä¹‰åè®®å¤§ç±»ï¼ˆUIæ˜¾ç¤ºç”¨ï¼‰
export type ProtocolType = 'WebSocket' | 'TCP' | 'UDP' | 'MQTT' | 'HTTP'

// 2. å®é™…åº•å±‚åè®®ï¼ˆåº•å±‚é€»è¾‘ç”¨ï¼‰
export type ConnectionProtocol = 'ws' | 'wss' | 'tcp' | 'udp' | 'mqtt' | 'http' | 'https'

export interface ServerConfig {
  // ç§»é™¤å•ç‹¬çš„ host/port/protocol ç»‘å®šï¼Œæ”¹ä¸º UI çŠ¶æ€ + è§£æç»“æœ
  protocolType: ProtocolType     // ç”¨æˆ·é€‰æ‹©çš„å¤§ç±»
  fullAddress: string            // ç”¨æˆ·è¾“å…¥çš„å®Œæ•´å­—ç¬¦ä¸²
  
  // ä»¥ä¸‹å­—æ®µç”±è§£æå‡½æ•°ç”Ÿæˆï¼Œç”¨äºåº•å±‚è¿æ¥
  parsedHost: string
  parsedPort: number
  parsedProtocol: ConnectionProtocol
  parsedPath?: string            // WebSocket å¯èƒ½éœ€è¦çš„è·¯å¾„
}

// ... å…¶ä»– LoginConfig, HeartbeatConfig ä¿æŒä¸å˜
```



### 2. æ›´æ–°çŠ¶æ€ç®¡ç† Store



**æ–‡ä»¶ï¼š** `src/renderer/src/store/connection.ts`

TypeScript

```
import { defineStore } from 'pinia'
import { ref } from 'vue'
import type { ProtocolType, ConnectionProtocol } from '@shared/types'

export const useConnectionStore = defineStore('connection', () => {
  // çŠ¶æ€ï¼šUI ç»‘å®šçš„æ•°æ®
  const protocolType = ref<ProtocolType>('WebSocket')
  const fullAddress = ref('ws://localhost:18080')
  
  // çŠ¶æ€ï¼šåº•å±‚è¿æ¥ç”¨çš„è§£ææ•°æ®
  const connectionParams = ref({
    host: 'localhost',
    port: 18080,
    protocol: 'ws' as ConnectionProtocol,
    path: ''
  })

  // æ ¸å¿ƒé€»è¾‘ï¼šæ™ºèƒ½åœ°å€è§£æ
  const parseAddress = (): boolean => {
    let input = fullAddress.value.trim()
    
    // 1. å¦‚æœæ²¡æœ‰åè®®å¤´ï¼Œæ ¹æ®é€‰æ‹©çš„å¤§ç±»è‡ªåŠ¨è¡¥å…¨
    if (!input.includes('://')) {
      const prefixMap: Record<ProtocolType, string> = {
        'WebSocket': 'ws://',
        'TCP': 'tcp://',
        'UDP': 'udp://',
        'MQTT': 'mqtt://',
        'HTTP': 'http://'
      }
      input = (prefixMap[protocolType.value] || 'ws://') + input
    }

    try {
      const url = new URL(input)
      
      // 2. è§£æå¹¶æ›´æ–°åº•å±‚å‚æ•°
      connectionParams.value.host = url.hostname
      // ç«¯å£å¤„ç†ï¼šå¦‚æœæ²¡å¡«ç«¯å£ï¼Œæ ¹æ®åè®®ç»™é»˜è®¤å€¼
      if (!url.port) {
        const defaultPorts: Record<string, number> = { 'ws:': 80, 'wss:': 443, 'http:': 80, 'https:': 443, 'mqtt:': 1883 }
        connectionParams.value.port = defaultPorts[url.protocol] || 80
      } else {
        connectionParams.value.port = parseInt(url.port)
      }
      
      // åè®®å¤„ç†ï¼šåŒºåˆ† ws/wss
      const protocolStr = url.protocol.replace(':', '')
      connectionParams.value.protocol = protocolStr as ConnectionProtocol
      connectionParams.value.path = url.pathname + url.search // ä¿ç•™ /ws/4g?token=xxx

      console.log('è§£æç»“æœ:', connectionParams.value)
      return true
    } catch (e) {
      console.error('åœ°å€è§£æå¤±è´¥:', e)
      return false
    }
  }

  return {
    protocolType,
    fullAddress,
    connectionParams,
    parseAddress,
    // ... å…¶ä»–åŸæœ‰çŠ¶æ€ (deviceConfig, heartbeatConfig ç­‰)
  }
})
```

------



## ğŸ¨ é˜¶æ®µäºŒï¼šUI å¸ƒå±€é‡æ„ (Layout Layer)



**ä»»åŠ¡ï¼š** å®ç° **Header(Logo) -> TopBar(è¿æ¥æ ) -> Content(å·¦å³åˆ†æ )** çš„å¸ƒå±€ã€‚



### 1. é‡å†™ä¸»è§†å›¾



**æ–‡ä»¶ï¼š** `src/renderer/src/views/MainView.vue`

ä»£ç æ®µ

```
<template>
  <div class="app-container">
    <div class="top-bar">
      <div class="brand">
        <el-icon :size="20" class="logo-icon"><Connection /></el-icon>
        <span class="app-title">Dev-Linker</span>
      </div>
      
      <div class="connection-controls">
        <el-select v-model="store.protocolType" class="protocol-select" placeholder="åè®®">
          <el-option label="WebSocket" value="WebSocket" />
          <el-option label="TCP" value="TCP" />
          <el-option label="UDP" value="UDP" />
          <el-option label="MQTT" value="MQTT" />
          <el-option label="HTTP" value="HTTP" />
        </el-select>

        <el-input 
          v-model="store.fullAddress" 
          class="address-input"
          :placeholder="addressPlaceholder"
          clearable
        />

        <el-button 
          :type="isConnected ? 'danger' : 'primary'" 
          :loading="isConnecting"
          class="connect-btn"
          @click="handleConnectionAction"
        >
          {{ isConnected ? 'æ–­å¼€' : (isConnecting ? 'è¿æ¥ä¸­' : 'è¿æ¥') }}
        </el-button>
      </div>
      
      <div class="status-indicator" :class="store.connectionStatus">
        <div class="dot"></div>
      </div>
    </div>

    <div class="main-content">
      <aside class="settings-pane">
        <ConnectionConfig />
      </aside>

      <main class="interaction-pane">
        <DataInteraction />
      </main>
    </div>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { useConnectionStore } from '@/store/connection'
import ConnectionConfig from '@/components/ConnectionConfig.vue'
import DataInteraction from '@/components/DataInteraction.vue'
import { Connection } from '@element-plus/icons-vue'
import { WebSocketManager } from '@/utils/websocket' // å‡è®¾å¼•ç”¨è·¯å¾„
import { TCPSocket } from '@/utils/tcp'

const store = useConnectionStore()
const wsManager = new WebSocketManager()
// ... TCP å®ä¾‹ç­‰

const isConnected = computed(() => store.connectionStatus === 'connected')
const isConnecting = computed(() => store.connectionStatus === 'connecting')

const addressPlaceholder = computed(() => {
  switch (store.protocolType) {
    case 'WebSocket': return 'ws://localhost:18080 æˆ– wss://remote.com/path'
    case 'TCP': return 'localhost:18888'
    default: return 'è¯·è¾“å…¥æœåŠ¡å™¨åœ°å€'
  }
})

const handleConnectionAction = async () => {
  if (isConnected.value) {
    // æ‰§è¡Œæ–­å¼€é€»è¾‘
    // ...
  } else {
    // 1. å…ˆè§£æåœ°å€
    if (!store.parseAddress()) {
      // æç¤ºåœ°å€é”™è¯¯
      return
    }
    
    // 2. æ ¹æ®è§£æåçš„ connectionParams å‘èµ·è¿æ¥
    const { protocol, host, port, path } = store.connectionParams
    if (protocol.startsWith('ws')) {
       const url = `${protocol}://${host}:${port}${path}`
       // è°ƒç”¨ wsManager.connect(url) ...
    }
    // ... å…¶ä»–åè®®é€»è¾‘
  }
}
</script>

<style scoped>
.app-container {
  height: 100vh;
  display: flex;
  flex-direction: column;
  background: #1e1e1e; /* æ·±è‰²èƒŒæ™¯ï¼Œä¸“ä¸šæ„Ÿ */
  color: #fff;
}

.top-bar {
  height: 60px;
  background: #252526;
  border-bottom: 1px solid #333;
  display: flex;
  align-items: center;
  padding: 0 16px;
  gap: 16px;
  flex-shrink: 0;
}

.brand {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: bold;
  color: #409eff;
  min-width: 120px;
}

.connection-controls {
  flex: 1;
  display: flex;
  gap: 10px;
}

.protocol-select { width: 120px; }
.address-input { flex: 1; }
.connect-btn { width: 100px; font-weight: bold; }

.main-content {
  flex: 1;
  display: flex;
  overflow: hidden; /* å…³é”®ï¼šç¦æ­¢æº¢å‡º */
}

.settings-pane {
  width: 300px;
  background: #2d2d2d;
  border-right: 1px solid #333;
  display: flex;
  flex-direction: column;
}

.interaction-pane {
  flex: 1;
  background: #1e1e1e;
  overflow: hidden;
}

/* çŠ¶æ€ç¯æ ·å¼ */
.status-indicator .dot {
  width: 10px; height: 10px; border-radius: 50%; background: #666;
}
.status-indicator.connected .dot { background: #67c23a; box-shadow: 0 0 8px #67c23a; }
</style>
```

------



## âš™ï¸ é˜¶æ®µä¸‰ï¼šç»„ä»¶åŠŸèƒ½ç²¾ç®€ (Components Layer)



**ä»»åŠ¡ï¼š** æ”¹é€  `ConnectionConfig.vue`ï¼Œç§»é™¤è¿æ¥åŠŸèƒ½ï¼Œä»…ä½œä¸ºé…ç½®é¢æ¿ï¼Œåšåˆ°**æ‰“å¼€å³è§ï¼Œæ— éœ€æ»šåŠ¨**ã€‚



### é‡æ„é…ç½®é¢æ¿



**æ–‡ä»¶ï¼š** `src/renderer/src/components/ConnectionConfig.vue`

ä»£ç æ®µ

```
<template>
  <div class="config-container">
    <div class="config-group">
      <div class="group-title">è®¾å¤‡æ ‡è¯†</div>
      <el-input v-model="store.deviceConfig.sn" placeholder="Device SN">
        <template #prepend>SN</template>
        <template #append>
          <el-button @click="generateSN"><el-icon><Refresh /></el-icon></el-button>
        </template>
      </el-input>
    </div>

    <div class="config-group">
      <div class="group-header">
        <div class="group-title">æ³¨å†Œ/ç™»å½•åŒ…</div>
        <el-switch v-model="store.loginConfig.enabled" size="small" />
      </div>
      
      <div v-if="store.loginConfig.enabled" class="compact-form">
        <div class="row">
          <el-radio-group v-model="store.loginConfig.format" size="small">
            <el-radio-button label="string">STR</el-radio-button>
            <el-radio-button label="hex">HEX</el-radio-button>
          </el-radio-group>
        </div>
        <el-input 
          v-model="store.loginConfig.content" 
          type="textarea" 
          :rows="2" 
          placeholder="è¿æ¥æˆåŠŸåè‡ªåŠ¨å‘é€"
          resize="none"
        />
      </div>
    </div>

    <div class="config-group">
      <div class="group-header">
        <div class="group-title">å¿ƒè·³ç»´æŒ</div>
        <el-switch v-model="store.heartbeatConfig.enabled" size="small" />
      </div>

      <div v-if="store.heartbeatConfig.enabled" class="compact-form">
        <div class="row">
          <span class="label">é—´éš”(ç§’):</span>
          <el-input-number v-model="store.heartbeatConfig.interval" size="small" :min="1" controls-position="right" style="width: 80px;" />
          
          <el-radio-group v-model="store.heartbeatConfig.format" size="small" style="margin-left: auto;">
            <el-radio-button label="string">STR</el-radio-button>
            <el-radio-button label="hex">HEX</el-radio-button>
          </el-radio-group>
        </div>
        <el-input 
          v-model="store.heartbeatConfig.content" 
          placeholder="å¿ƒè·³å†…å®¹" 
          size="small"
        />
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { useConnectionStore } from '@/store/connection'
import { Refresh } from '@element-plus/icons-vue'
import { ElMessage } from 'element-plus'

const store = useConnectionStore()

const generateSN = () => {
  store.deviceConfig.sn = 'DEV-' + Math.random().toString(36).substr(2, 6).toUpperCase()
}
</script>

<style scoped>
.config-container {
  padding: 16px;
  color: #ccc;
}

.config-group {
  margin-bottom: 20px;
  background: #333;
  padding: 12px;
  border-radius: 4px;
}

.group-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.group-title {
  font-size: 12px;
  font-weight: bold;
  color: #aaa;
  text-transform: uppercase;
}

.compact-form {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.row {
  display: flex;
  align-items: center;
  gap: 8px;
}

.label {
  font-size: 12px;
}

/* å¼ºåˆ¶è¦†ç›– Element Plus æ ·å¼ä»¥é€‚åº”æ·±è‰²ç´§å‡‘å¸ƒå±€ */
:deep(.el-input__wrapper), :deep(.el-textarea__inner) {
  background-color: #1e1e1e;
  box-shadow: none;
  border: 1px solid #444;
  color: #fff;
}
</style>
```

------



## ğŸ“ æ€»ç»“ä¸æ‰§è¡Œå»ºè®®



1. **ä¼˜å…ˆæ‰§è¡Œé˜¶æ®µä¸€ï¼ˆLogicï¼‰**ï¼šç¡®ä¿ `connection.ts` ä¸­çš„ `parseAddress` é€»è¾‘æ­£ç¡®ï¼Œè¿™æ˜¯â€œæ¨¡æ‹ŸçœŸå®æ¨¡å—â€çš„æ ¸å¿ƒã€‚
2. **å¸ƒå±€æ›¿æ¢ï¼ˆLayoutï¼‰**ï¼šå°† `MainView.vue` æ›¿æ¢åï¼Œæ‚¨ä¼šç«‹åˆ»çœ‹åˆ°ç•Œé¢çš„å·¨å¤§å˜åŒ–ï¼Œè¿æ¥æ ç½®é¡¶åï¼Œå¯è§†ç©ºé—´ä¼šç¬é—´å˜å¤§ã€‚
3. **ç»„ä»¶ç˜¦èº«ï¼ˆComponentï¼‰**ï¼š`ConnectionConfig.vue` ç»è¿‡ç˜¦èº«åï¼Œå³ä½¿åœ¨å°å±å¹•ä¸Šï¼Œæ‰€æœ‰é…ç½®ï¼ˆSNã€ç™»å½•ã€å¿ƒè·³ï¼‰ä¹Ÿåº”è¯¥èƒ½åœ¨ä¸€ä¸ªå±å¹•å†…å®Œå…¨æ˜¾ç¤ºï¼Œæ— éœ€æ»šåŠ¨ã€‚

è¿™å¥—æ–¹æ¡ˆå®Œå…¨å¥‘åˆæ‚¨**â€œæ‰€è§å³æ‰€å¾—ã€æ‰“å¼€å³ç”¨ã€ä¸åŒºåˆ†ws/wssâ€**çš„éœ€æ±‚ã€‚