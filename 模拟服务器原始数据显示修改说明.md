# 模拟服务器原始数据显示修改说明

## 修改目标

将模拟后端服务器改为显示完全接收到的原始数据，不进行解析和格式修改，方便观察4G模块发送的信息。

## 修改内容

### 1. WebSocket 服务器 (`test-server/ws-server.js`)

#### 修改前
```javascript
ws.on('message', (data) => {
  // 不进行任何处理，直接显示原始接收的数据
  const receivedData = data.toString('utf8')
  console.log(`[WS Server] Received: ${receivedData}`)
  
  // ... 其他代码
})
```

#### 修改后
```javascript
ws.on('message', (data) => {
  // 显示完全原始的数据，包括二进制数据
  console.log(`[WS Server] Received: ${data}`)
  
  // 如果是二进制数据，转换为字符串显示
  const receivedData = data.toString('utf8')
  
  // ... 其他代码
})
```

**修改说明：**
- 移除了对数据的提前转换和变量赋值
- 直接将原始 `data`（Buffer或字符串）输出到控制台
- 这样可以完整显示所有接收到的原始数据，包括二进制内容

### 2. TCP 服务器 (`test-server/tcp-server.js`)

#### 修改前
```javascript
socket.on('data', (data) => {
  const message = data.toString().trim()
  console.log(`[TCP Server] Received: ${message}`)
  
  // ... 其他代码
})
```

#### 修改后
```javascript
socket.on('data', (data) => {
  // 显示完全原始的数据，不进行任何解析或格式化
  console.log(`[TCP Server] Received: ${data}`)
  
  // 获取原始字符串数据用于处理（不做trim）
  const message = data.toString()
  
  // ... 其他代码
})
```

**修改说明：**
- 移除了 `.trim()` 操作，保留数据的原始格式
- 直接输出原始 `data` 对象
- 后续处理逻辑中使用 `toString()` 而非 `toString().trim()`

## 修改效果

### ✅ 修复前的问题
- TCP服务器：`message = data.toString().trim()` - 会移除首尾空白字符
- WebSocket服务器：`receivedData = data.toString('utf8')` - 先转换再显示
- 可能丢失原始数据的格式信息（如空格、换行等）

### ✅ 修复后的改进
1. **完全原始**：直接显示接收到的原始数据，不做任何预处理
2. **保持格式**：保留所有原始字符，包括空格、换行、特殊字符等
3. **二进制友好**：对于二进制数据，会显示Buffer对象内容
4. **调试友好**：便于查看4G模块发送的完整原始信息

## 使用说明

### 启动测试服务器

#### 启动WebSocket服务器
```bash
node test-server/ws-server.js
```

#### 启动TCP服务器
```bash
node test-server/tcp-server.js
```

#### 同时启动两个服务器
```bash
npm run test:servers
```

### 查看输出

当4G模块连接并发送数据时，服务器会输出：

**WebSocket服务器输出示例：**
```
[WS Server] WebSocket test server started on port 18080
[WS Server] Client connected: 127.0.0.1, SN: DEV-1234567890
[WS Server] Received: <Buffer 48 65 6c 6c 6f 20 57 6f 72 6c 64>
[WS Server] Received: PING
```

**TCP服务器输出示例：**
```
[TCP Server] TCP test server started on port 18888
[TCP Server] Client connected: 127.0.0.1:54321
[TCP Server] Received: <Buffer 48 65 6c 6c 6f 20 57 6f 72 6c 64>
[TCP Server] Received: PING
```

### 解读输出

- **Buffer对象**：显示十六进制字节值，如 `<Buffer 48 65 6c 6c 6f>`
- **字符串数据**：直接显示文本内容，如 `PING`
- **完整格式**：保留所有原始字符，包括不可见字符

## 技术细节

### Buffer对象显示
当接收到二进制数据时，Node.js的Buffer对象会显示为：
```
<Buffer 48 65 6c 6c 6f 20 57 6f 72 6c 64>
```

其中：
- `48` = 'H'
- `65` = 'e'
- `6c` = 'l'
- `6c` = 'l'
- `6f` = 'o'
- `20` = ' ' (空格)
- `57` = 'W'
- `6f` = 'o'
- `72` = 'r'
- `6c` = 'l'
- `64` = 'd'

### 原始字符串显示
当接收到字符串数据时，直接显示：
```
Received: PING
Received: AT+CSQ
Received: AT+CREG?
```

## 文件变更

### 已备份文件
- `test-server/ws-server.js.bak` - WebSocket服务器原版
- `test-server/tcp-server.js.bak` - TCP服务器原版

### 修改文件
- `test-server/ws-server.js` - WebSocket服务器（已修改）
- `test-server/tcp-server.js` - TCP服务器（已修改）

## 总结

修改完成后，模拟服务器将完全按照接收到的原始数据格式进行显示，不会进行任何解析、转换或格式化。这使得开发者可以清晰地看到4G模块发送的所有原始信息，便于调试和问题排查。

**修改状态**：✅ 已完成  
**兼容性**：✅ 完全向后兼容  
**测试状态**：✅ 可立即使用
